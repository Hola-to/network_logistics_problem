# deploy/k8s/overlays/staging/kustomization.yaml

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: logistics-staging

resources:
  - ../../base

nameSuffix: -staging

patches:
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
    target:
      kind: Deployment

  - patch: |-
      - op: replace
        path: /data/APP_ENV
        value: staging
      - op: replace
        path: /data/TRACING_SAMPLE_RATE
        value: "0.5"
    target:
      kind: ConfigMap
      name: logistics-config

  - path: ingress-patch.yaml

images:
  - name: solver-svc
    newName: ghcr.io/your-org/solver-svc
    newTag: staging
  - name: validation-svc
    newName: ghcr.io/your-org/validation-svc
    newTag: staging
  - name: analytics-svc
    newName: ghcr.io/your-org/analytics-svc
    newTag: staging
  - name: auth-svc
    newName: ghcr.io/your-org/auth-svc
    newTag: staging
  - name: history-svc
    newName: ghcr.io/your-org/history-svc
    newTag: staging
  - name: audit-svc
    newName: ghcr.io/your-org/audit-svc
    newTag: staging
  - name: simulation-svc
    newName: ghcr.io/your-org/simulation-svc
    newTag: staging
  - name: report-svc
    newName: ghcr.io/your-org/report-svc
    newTag: staging
  - name: gateway-svc
    newName: ghcr.io/your-org/gateway-svc
    newTag: staging
